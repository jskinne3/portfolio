<!DOCTYPE html>
<html>
<head>
  <title>John Skiles Skinner's portfolio</title>
  <meta name="description" content="What I learned about linking Amazon s3, Route53, CloudFront and a domain name registrar">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="stylesheet" href="/old_main.css">
  <link rel="stylesheet" href="/old_blog.css">

  <link rel="icon" href="../favicon.ico" />
  <link rel="shortcut icon" href="../favicon.ico" />
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Varela+Round|Open+Sans" >
</head>
<body>
  <h1><a class="invisilink" href="http://johnskinnerportfolio.com/">John Skiles Skinner's portfolio</a></h1>

  <article>
    <div class="darkband">
      <div class="articleillushead">
        <div>
          <img class="headillus" src="/img/AWSservicesDiagram.png" />
        </div>
        <div>
          <h2>The Secret was CNAMEs</h2>
          <p>What I learned about linking Amazon s3, Route53, CloudFront and a domain name registrar</p>
          <time class="block">11 July 2018</time>
        </div>
        
      </div>
    </div>
    <p>
      I wish to point a domain name registered with GoDaddy to a website created with Amazon Web Services <a href="https://console.aws.amazon.com/quickstart-website/home">Quickstart for Websites</a>. Here were the hitches I came across.
    </p>
    <p>
      My registrar needs to know what nameservers to use. GoDaddy has a DNS Management form into which the names of the nameservers can be pasted. It's not so obvious from the AWS console for my quickstarted website where the names for the nameservers might come from. A sidebar in the console offers to sell me a domain, and it notes "You can also associate your own domain with your website" but it does not say how!
    </p>
    <p>
      The nameserver names come from AWS's <a href="https://console.aws.amazon.com/route53/home#hosted-zones">Route53 console</a>. I <a href="https://forums.aws.amazon.com/thread.jspa?threadID=259099">read that</a> one must create a <em>hosted zone</em> to act as a container for the nameservers. I press the Create Hosted Zone button and enter my domain name in the box. A new entry appears in the list of hosted zones. It contains a table of <em>record sets</em>. One of these is of Type NS, which, rather obscurely, means nameservers. I copy the list of four nameserver names.
    </p>
    <p>
      Each of the names ends in a dot. This feels a little wrong to me; things that resemble URLs don't usually end in dots. But I read that a <em>fully qualified domain name</em> does indeed <a href="http://www.dns-sd.org/trailingdotsindomainnames.html">include a trailing dot</a>. However, my registrar treats the trailing dot as an invalid character. So I strip out the final dots and hope for the best.
    </p>
    <p>
      Further, I read that I need to create an Alias. This will be used to point to the AWS CloudFront name through which my website is accessible. An Alias is another Route53 record set, so I press the Create Record Set button within my new hosted zone. Upon selecting a radio button to mark the record set as an Alias, I'm asked for an Alias Target. I extract this out of the URL that AWS has assigned to my website, so that it looks something like <kbd>dl7mbasum9fk44.cloudfront.net</kbd>, and hit Save Record Set.
    </p>
    <p>
      At this point, once the DNS changes propagate, I'm hoping to see my new website at my new domain. Instead, my browser shows me this error:
    </p>
    <samp class="block">
      403 ERROR<br />
      The request could not be satisfied.<br />
      Bad request.<br />
      Generated by cloudfront (CloudFront)<br />
    </samp>
    <p>
      Now at least I know that visitors to my new domain name are getting as far as AWS CloudFront. HTTP status 403 is an authorization error. Is there some permission set incorrectly somewhere? Or an SSL certificate issue? I experimented with these guesses but didn't get far. Through much trial and error (which I don't want to ever re-do, hence this blog post) I discovered that the fix is adding a <em>CNAME</em>.
    </p>
    <p>
      In the <a href="https://console.aws.amazon.com/cloudfront/home">CloudFront console</a> I clicked on the ID of my distribution on the list. (The correct item on the list can be hard to identify if the list is long; I found it by comparing the randomly-generated strings in CloudFront names.) I went to the General tab, clicked the Edit button, and pasted my domain name into the CNAME box.
    </p>
    <p>
      I was under the impression that CNAMEs were something I had to concern myself with only if I were using a subdomain, which I'm not. Evidently I misunderstood, because when I entered the domain name itself, bare of any subdomain, as a CNAME, it immediately resulted in my new website replacing the 403 error page.
    </p>
    <p>
      I think it's a little strange that AWS needs me to specify my domain name a second time &mdash; remember, I already entered it when I created a hosted zone, and now again as a CNAME. I'm happy it works, but it looks like I have much more to learn.
    </p>
  </article>
  <hr />
  <p><a href="#top">Top of page</a> | <a href="index.html">Blog index</a> | <a href="../index.html">Return home</a></p>

</body>
</html>